# 🌐 Cloudflare Pages ドメイン設定 詳細手順書

既存のGitHub Pages設定を活かしながら、Cloudflare Pagesに移行して複数のサブドメインを設定する、画面クリックからコマンド入力まで全ての詳細な手順です。

## 📋 前提条件

### 現在の設定状況
- ✅ GitHub Pagesでカスタムドメイン設定済み（例: `yourdomain.com`）
- ✅ お名前.comでDNS設定済み（GitHub PagesのIPアドレスを指している）
- ✅ サイトが正常に表示されている

### 移行後の構成
- **メインサイト**: `yourdomain.com` → Cloudflare Pages
- **Affilingサイト**: `affiling.yourdomain.com` → Cloudflare Pages（新規）

---

## 🔍 ステップ1: 現在の設定を確認

### 1-1. GitHub Pagesの設定を確認

1. ブラウザで https://github.com/Kiichi-1000/synthera-web を開く
2. 「**Settings**」タブをクリック
3. 左サイドバーの「**Pages**」をクリック
4. 「**Custom domain**」セクションを確認
   - 現在設定されているドメインをメモ（例: `yourdomain.com`）

### 1-2. お名前.comのDNS設定を確認

1. お名前.comにログイン: https://www.onamae.com/
2. 「**ドメイン**」→「**DNS設定**」をクリック
3. 設定したいドメインを選択
4. 現在のDNSレコードを確認
   - **Aレコード**: GitHub PagesのIPアドレス（`185.199.108.153`など）
   - **CNAMEレコード**: あれば確認（例: `www` → `kiichi-1000.github.io`）
5. 設定内容をスクリーンショットまたはメモしておく

### 1-3. 現在のサイトが正常に表示されることを確認

1. ブラウザで `https://yourdomain.com` を開く
2. サイトが正常に表示されることを確認
3. 各ページが正常に動作することを確認

---

## 🚀 ステップ2: Cloudflareアカウントを作成

### 2-1. Cloudflareにアクセス

1. ブラウザで https://www.cloudflare.com/ja-jp/ を開く
2. ページ右上の「**サインアップ**」ボタンをクリック

### 2-2. アカウント情報を入力

1. 「**メールアドレス**」テキストボックスをクリック
2. メールアドレスを入力（例: `your@email.com`）
3. 「**パスワード**」テキストボックスをクリック
4. パスワードを入力（8文字以上、大文字・小文字・数字を含む）
5. 「**サインアップ**」ボタンをクリック

### 2-3. メール認証

1. 登録したメールアドレスの受信トレイを確認
2. Cloudflareから送信された認証メールを開く
3. 「**Verify Email Address**」ボタンをクリック
4. ブラウザで認証ページが開くことを確認

### 2-4. アカウント設定を完了

1. 認証後、Cloudflareダッシュボードが表示される
2. 必要に応じて、プロフィール情報を入力（オプション）
3. 「**続行**」または「**スキップ**」をクリック

---

## 🌍 ステップ3: ドメインをCloudflareに追加

### 3-1. サイトを追加

1. Cloudflareダッシュボードのトップページで「**サイトを追加**」ボタンをクリック
   - または、左サイドバーの「**Webサイト**」をクリック → 「**サイトを追加**」

### 3-2. ドメイン名を入力

1. 「**サイトの追加**」ページが表示されます
2. 「**ドメイン名を入力**」テキストボックスをクリック
3. ドメイン名を入力（例: `yourdomain.com`）
   - **重要**: `https://` や `http://` は不要
   - **重要**: `www` も不要（例: `yourdomain.com` だけ）
4. 「**サイトを追加**」ボタンをクリック

### 3-3. プランを選択

1. 「**プランを選択**」ページが表示されます
2. 「**無料プラン**」を選択（「Free」と表示されているもの）
3. 「**続行**」ボタンをクリック

### 3-4. DNSレコードを確認

1. 「**DNSレコードを確認**」ページが表示されます
2. 自動的に既存のDNSレコードがインポートされているか確認
   - 表示されない場合は、手動で追加する必要があります（次のステップで説明）

#### 自動インポートされたレコードがある場合

- 既存のDNSレコードが表示される場合は、そのまま「**続行**」をクリック
- レコードを確認して、必要に応じて編集

#### 自動インポートされていない場合

1. 「**レコードを追加**」ボタンをクリック
2. 既存のDNSレコードを手動で追加：
   - **Aレコード**（メインドメイン用）: ホスト名 `@`、値は一時的にGitHub PagesのIPアドレス（後で変更）
   - **CNAMEレコード**（www用）: ホスト名 `www`、値 `kiichi-1000.github.io`（後で変更）

3. レコードを追加したら「**続行**」をクリック

### 3-5. ネームサーバーを取得

1. 「**ネームサーバー**」ページが表示されます
2. **重要**: このページに表示されている2つのネームサーバー情報をメモまたはスクリーンショット
   - 例: `alice.ns.cloudflare.com` と `bob.ns.cloudflare.com`
   - **重要**: この情報は次のステップで必要です

3. 「**続行**」ボタンをクリック（この時点ではネームサーバー変更は行わない）

---

## 🔧 ステップ4: お名前.comでネームサーバーを変更

**重要**: このステップは、Cloudflare Pagesの設定が完了してから行うことを推奨します。ただし、DNS設定を理解するために先に説明します。

### 4-1. お名前.comにログイン

1. ブラウザで https://www.onamae.com/ を開く
2. ページ右上の「**ログイン**」ボタンをクリック
3. お名前.com IDとパスワードを入力
4. 「**ログイン**」ボタンをクリック

### 4-2. ネームサーバー設定ページに移動

1. ログイン後、ダッシュボードが表示されます
2. ページ上部のメニューから「**ドメイン**」を探す
   - または、左サイドメニューから「**ドメイン**」を探す
3. 「**ドメイン**」をクリック
4. 「**ネームサーバー設定**」をクリック

### 4-3. 設定するドメインを選択

1. 購入したドメインの一覧が表示されます
2. 設定したいドメイン名を見つける
3. そのドメインの「**ネームサーバー設定**」のリンクをクリック

### 4-4. ネームサーバーを変更

1. 現在のネームサーバー設定が表示されます
2. 「**ネームサーバーを設定する**」または「**変更**」ボタンをクリック

3. ネームサーバーの設定方法を選択：
   - 「**ネームサーバーを設定する**」を選択

4. ネームサーバー1とネームサーバー2のテキストボックスが表示されます

5. Cloudflareから取得したネームサーバー情報を入力：
   - **ネームサーバー1**: Cloudflareから取得した1つ目のネームサーバー（例: `alice.ns.cloudflare.com`）
   - **ネームサーバー2**: Cloudflareから取得した2つ目のネームサーバー（例: `bob.ns.cloudflare.com`）

6. 「**保存**」または「**適用**」ボタンをクリック

7. 確認ダイアログが表示されたら「**OK**」または「**確認**」をクリック

8. 「設定が完了しました」などのメッセージが表示されることを確認

### 4-5. ネームサーバー変更の反映を確認

**重要**: ネームサーバーの変更は数分〜最大48時間かかります（通常は数時間以内）。

**確認方法（ターミナルで実行）:**

1. ターミナルを開く
2. 以下のコマンドを実行（`yourdomain.com`を実際のドメインに置き換える）:

```bash
nslookup -type=NS yourdomain.com
```

3. 結果を確認:
   - ✅ 成功: Cloudflareのネームサーバー（例: `alice.ns.cloudflare.com`, `bob.ns.cloudflare.com`）が表示されればOK
   - ❌ まだ反映されていない: お名前.comのネームサーバーが表示される場合は、数時間待ってから再度確認

**または、オンラインツールで確認:**
- https://dnschecker.org/ を開く
- `yourdomain.com` を入力して「**Search**」をクリック
- 「NS」タブを選択して、Cloudflareのネームサーバーが表示されるか確認

---

## 📦 ステップ5: Cloudflare Pagesでメインサイトを作成

### 5-1. Workers & Pagesページを開く

1. Cloudflareダッシュボードの左サイドバーで「**Workers & Pages**」をクリック
   - または、トップページから「**Workers & Pages**」をクリック

### 5-2. プロジェクトを作成

1. 「**作成**」ボタンをクリック
   - ページ上部または中央に表示されている
2. ドロップダウンメニューから「**ページ**」を選択

### 5-3. GitHubと接続

1. 「**GitHubと接続**」ボタンをクリック
2. GitHubのログインページが開きます
3. GitHubアカウントでログイン
4. 「**Authorize Cloudflare Pages**」をクリックして権限を付与
5. GitHubに戻り、Cloudflareがリポジトリにアクセスできることを確認

### 5-4. リポジトリを選択

1. リポジトリの一覧が表示されます
2. `synthera-web` リポジトリを見つける
3. `synthera-web` リポジトリの「**設定を開始**」ボタンをクリック

### 5-5. プロジェクト設定

1. 「**プロジェクト設定**」ページが表示されます

2. 以下の情報を入力：

#### 基本設定

- **プロジェクト名**: `synthera-main` と入力
  - 任意の名前でも可（例: `synthera-website`）

- **本番ブランチ**: `main` を選択
  - ドロップダウンから「**main**」を選択

#### ビルド設定

- **ビルドコマンド**: 空白のまま
  - 静的サイトのため、ビルドコマンドは不要

- **ビルド出力ディレクトリ**: 空白のまま、または `/` と入力
  - ルートディレクトリから直接デプロイ

- **ルートディレクトリ**: 空白のまま、または `/` と入力
  - リポジトリのルートからデプロイ

3. 「**保存してデプロイ**」ボタンをクリック

### 5-6. 初回デプロイを確認

1. デプロイが開始されます（1-2分かかります）
2. 「**デプロイ履歴**」タブでデプロイ状況を確認
3. 「**準備完了**」または「**成功**」と表示されるまで待つ

### 5-7. プレビューURLを確認

1. デプロイが完了すると、プレビューURLが表示されます
   - 例: `https://synthera-main-xxxxx.pages.dev`
2. このURLをクリックして、サイトが正常に表示されることを確認

---

## 🌐 ステップ6: メインサイトにカスタムドメインを設定

### 6-1. カスタムドメイン設定ページを開く

1. Cloudflare Pagesのプロジェクトページ（`synthera-main`）で「**カスタムドメイン**」タブをクリック
   - プロジェクト名の下にあるタブメニュー

### 6-2. カスタムドメインを追加

1. 「**カスタムドメインを設定**」ボタンをクリック
2. 「**ドメインを設定**」テキストボックスをクリック
3. メインドメインを入力: `yourdomain.com`
   - **重要**: `https://` や `http://` は不要
   - **重要**: `www` も不要（`yourdomain.com` だけ）
4. 「**接続を開始**」ボタンをクリック

### 6-3. DNS設定を確認

1. Cloudflareが自動的にDNSレコードを追加します
2. 「**DNS設定**」セクションで、以下のレコードが自動追加されることを確認：
   - **CNAMEレコード**: `yourdomain.com` → `synthera-main.pages.dev`
   - **TXTレコード**: 所有権確認用（自動追加）

3. 自動追加されない場合は、手動で追加：
   - Cloudflareダッシュボードで「**DNS**」をクリック
   - 「**レコードを追加**」をクリック
   - タイプ: `CNAME`、名前: `@`、ターゲット: `synthera-main.pages.dev`

### 6-4. 所有権の確認を待つ

1. DNS設定の反映を待ちます（数分〜数時間）
2. 「**DNSチェック**」が緑色のチェックマークになるまで待つ
3. 「**HTTPS**」が有効化されるまで待つ（通常は数分）

### 6-5. サイトの確認

1. 新しいタブを開く
2. アドレスバーに `https://yourdomain.com` を入力
3. Enterキーを押す
4. サイトがCloudflare Pagesから表示されることを確認
5. ブラウザのアドレスバーの左側に🔒マークが表示されていることを確認（HTTPSが有効）

---

## 🎯 ステップ7: Affilingサブドメイン用プロジェクトを作成

### 7-1. 新しいプロジェクトを作成

1. Cloudflare Pagesのトップページで「**作成**」→「**ページ**」をクリック
2. 「**GitHubと接続**」をクリック（既に接続済みの場合はスキップ）
3. `synthera-web` リポジトリを選択
4. 「**設定を開始**」をクリック

### 7-2. Affilingプロジェクトの設定

1. 「**プロジェクト設定**」ページで以下の情報を入力：

#### 基本設定

- **プロジェクト名**: `affiling-site` と入力

- **本番ブランチ**: `main` を選択

#### ビルド設定

- **ビルドコマンド**: 以下のコマンドを入力
  ```bash
  mkdir -p dist && cp affiling.html dist/index.html && cp affiling-article.html dist/ && cp -r css dist/ && cp -r js dist/ && cp -r data dist/ && cp -r assets dist/
  ```

  または、より簡潔に：
  ```bash
  cp affiling.html index.html
  ```

- **ビルド出力ディレクトリ**: `/` または `dist`（ビルドコマンドで `dist` を作成した場合）

- **ルートディレクトリ**: 空白のまま

**注意**: ビルドコマンドが複雑な場合は、後でビルド設定を調整できます。

3. 「**保存してデプロイ**」ボタンをクリック

### 7-3. 初回デプロイを確認

1. デプロイが開始されます（1-2分かかります）
2. 「**準備完了**」と表示されるまで待つ
3. プレビューURLをクリックして、Affilingサイトが正常に表示されることを確認

---

## 🔗 ステップ8: Affilingサブドメインを設定

### 8-1. カスタムドメイン設定ページを開く

1. `affiling-site` プロジェクトページで「**カスタムドメイン**」タブをクリック

### 8-2. サブドメインを追加

1. 「**カスタムドメインを設定**」ボタンをクリック
2. 「**ドメインを設定**」テキストボックスをクリック
3. サブドメインを入力: `affiling.yourdomain.com`
   - **重要**: フルサブドメイン名を入力（`affiling.yourdomain.com`）
4. 「**接続を開始**」ボタンをクリック

### 8-3. DNS設定を確認

1. Cloudflareが自動的にDNSレコードを追加します
2. Cloudflareダッシュボードで「**DNS**」をクリック
3. 以下のレコードが自動追加されることを確認：
   - **CNAMEレコード**: `affiling` → `affiling-site.pages.dev`

4. 自動追加されない場合は、手動で追加：
   - 「**レコードを追加**」をクリック
   - タイプ: `CNAME`
   - 名前: `affiling`（`affiling.yourdomain.com`ではなく）
   - ターゲット: `affiling-site.pages.dev`
   - プロキシ: オレンジ色のクラウドアイコンを有効化（推奨）
   - 「**保存**」をクリック

### 8-4. DNS設定の反映を待つ

1. DNS設定の反映には数分〜数時間かかります
2. 「**DNSチェック**」が緑色のチェックマークになるまで待つ
3. 「**HTTPS**」が有効化されるまで待つ

### 8-5. Affilingサイトの確認

1. 新しいタブを開く
2. アドレスバーに `https://affiling.yourdomain.com` を入力
3. Enterキーを押す
4. Affilingサイトが正常に表示されることを確認
5. ブラウザのアドレスバーの左側に🔒マークが表示されていることを確認

---

## 🔄 ステップ9: GitHub Pagesの設定を削除（オプション）

Cloudflare Pagesへの移行が完了したら、GitHub Pagesの設定を削除できます。

### 9-1. GitHub Pagesのカスタムドメインを削除

1. ブラウザで https://github.com/Kiichi-1000/synthera-web を開く
2. 「**Settings**」タブをクリック
3. 左サイドバーの「**Pages**」をクリック
4. 「**Custom domain**」セクションを見つける
5. カスタムドメインのテキストボックスを空にする
6. 「**Save**」ボタンをクリック

### 9-2. GitHub Pagesを無効化（オプション）

1. 「**Source**」セクションを見つける
2. ドロップダウンメニューから「**None**」を選択
3. 「**Save**」ボタンをクリック

**注意**: GitHub Pagesを無効化すると、GitHub PagesのURL（`https://kiichi-1000.github.io/synthera-web/`）でアクセスできなくなります。Cloudflare Pagesのみを使用する場合は問題ありません。

---

## 🔍 ステップ10: 全ての設定を確認

### 10-1. メインサイトの確認

- [ ] `https://yourdomain.com` が正常に表示される
- [ ] 全てのページが正常に動作する
- [ ] HTTPSが有効になっている（🔒マークが表示される）

### 10-2. Affilingサイトの確認

- [ ] `https://affiling.yourdomain.com` が正常に表示される
- [ ] Affilingサイトの全てのページが正常に動作する
- [ ] HTTPSが有効になっている

### 10-3. DNS設定の確認

1. Cloudflareダッシュボードで「**DNS**」をクリック
2. 以下のレコードが設定されていることを確認：
   - **CNAME**: `@` → `synthera-main.pages.dev`（メインサイト用）
   - **CNAME**: `affiling` → `affiling-site.pages.dev`（Affilingサイト用）
   - **CNAME**: `www` → （オプション、必要に応じて）

### 10-4. Cloudflare Pagesのデプロイ確認

1. Cloudflare Pagesダッシュボードで、両方のプロジェクトが表示されることを確認
2. 最新のデプロイが「**準備完了**」ステータスになっていることを確認

---

## 📊 トラブルシューティング

### サイトが表示されない

**確認方法:**
1. Cloudflare Pagesでデプロイが成功しているか確認
2. DNS設定が正しいか確認（`nslookup` コマンドで確認）
3. ブラウザのキャッシュをクリアして再試行

**解決方法:**
1. DNS設定の反映を待つ（最大48時間、通常は数時間以内）
2. Cloudflare Pagesのデプロイログを確認
3. カスタムドメイン設定を再確認

### HTTPSが有効化されない

**確認方法:**
1. Cloudflare Pagesの「**カスタムドメイン**」タブでHTTPSステータスを確認
2. DNS設定が正しく反映されているか確認

**解決方法:**
1. DNS設定の反映を待つ（通常は数分〜数時間）
2. 「**HTTPS設定を再確認**」ボタンをクリック
3. SSL証明書の自動発行を待つ

### サブドメインが表示されない

**確認方法:**
```bash
nslookup affiling.yourdomain.com
```

**解決方法:**
1. Cloudflare DNSでCNAMEレコードが正しく設定されているか確認
2. DNS設定の反映を待つ
3. プロキシ設定（オレンジ色のクラウドアイコン）を有効化

### ビルドエラーが発生する

**確認方法:**
1. Cloudflare Pagesの「**デプロイ履歴**」タブでエラーログを確認
2. ビルドコマンドが正しいか確認

**解決方法:**
1. ビルドコマンドを修正
2. ビルド出力ディレクトリを確認
3. シンプルなビルドコマンドに変更してみる

---

## 🎉 完了！

これで、既存のGitHub Pages設定を活かしながら、Cloudflare Pagesに移行して複数のサブドメインを設定できました！

### 次のステップ

1. **定期的な更新**: ファイルを変更してGitHubにプッシュすると、自動的にCloudflare Pagesにデプロイされます
2. **追加のサブドメイン**: 必要に応じて、同じ方法で追加のサブドメインを設定できます
3. **パフォーマンス最適化**: CloudflareのCDN機能で、サイトの読み込み速度が向上します

---

## 📚 参考リンク

- Cloudflare Pages ドキュメント: https://developers.cloudflare.com/pages/
- Cloudflare DNS設定: https://developers.cloudflare.com/dns/
- Cloudflare カスタムドメイン: https://developers.cloudflare.com/pages/platform/custom-domains/

