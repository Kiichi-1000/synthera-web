# Notionデータベース設定ガイド - Affiling記事

## 現在の実装方法

現在のシステムでは、記事内容を取得する方法が**2つ**あります：

1. **「Content」プロパティから取得**（プレーンテキストのみ）
2. **ページの本文（ブロック）から取得**（HTMLを含む、推奨）

## 記事内容の正しい書き方

### ✅ 推奨方法：ページの本文に書く

記事内容は**ページを開いて、本文に直接書いてください**。

1. Notionで記事のページを開く
2. 「Content」プロパティは**空のままでOK**
3. ページの本文エリアに記事内容を書く
   - 見出し、段落、リスト、画像などを自由に使えます
   - HTMLコードブロックも使用できます
   - リンクも使用できます

### ❌ 非推奨方法：「Content」プロパティに書く

「Content」プロパティに書くと：
- HTMLが削除されてプレーンテキストのみになります
- フォーマット（太字、リストなど）が失われます
- コードブロックや画像が使えません

## データベース設定の確認事項

現在のデータベースには以下のプロパティが必要です：

### 必須プロパティ

1. **Title** (タイトル) - `title`タイプ
   - 記事のタイトル

2. **Status** (ステータス) - `select`タイプ
   - 選択肢: `Draft`, `Published`, `Archived`
   - 記事が表示されるには `Published` にする必要があります

3. **Content** (コンテンツ) - `rich_text`タイプ
   - 空のままでOK（ページの本文から取得されます）

### オプションプロパティ

4. **Excerpt** (抜粋) - `rich_text`タイプ
   - 記事の説明文

5. **Category** (カテゴリ) - `select`タイプ
   - 選択肢: `comparison`, `ranking`, `review`, `guide`

6. **Date** (日付) - `date`タイプ
   - 記事の公開日

7. **Image** (画像) - `files`タイプ
   - サムネイル画像

8. **Read Time** (読了時間) - `number`タイプ
   - 分単位

9. **Product Count** (商品数) - `number`タイプ
   - 比較記事の場合の商品数

10. **Tags** (タグ) - `multi_select`タイプ
    - 記事のタグ

## 記事が反映されない場合の確認事項

### 1. Statusが「Published」になっているか確認

記事が表示されるには、Statusが `Published` である必要があります。

```
Status: Published ✅
Status: Draft ❌ (非公開)
Status: Archived ❌ (アーカイブ)
```

### 2. ページの本文に記事内容があるか確認

1. 記事のページを開く
2. ページの本文エリア（Contentプロパティの下）に内容があるか確認
3. 何も書かれていない場合は、そこに記事内容を書いてください

### 3. 同期を実行する

管理ページ（`http://127.0.0.1:8765/`）で：
1. 「Affiling Articles」の「Notionから同期」をクリック
2. エラーがないか確認
3. JSONファイル（`data/affiling_articles.json`）が更新されているか確認

### 4. ブラウザのキャッシュをクリア

記事が表示されない場合は、ブラウザのキャッシュをクリアしてください。

## 記事内容の書き方の例

### ✅ 正しい書き方

```
ページ: おすすめ家庭用脱毛器比較

[Contentプロパティ] ← 空のままでOK

[ページの本文]
# 記事のタイトル

記事の本文をここに書きます。

- リスト項目1
- リスト項目2

## 見出し2

もう少し文章を書きます。

[コードブロック: html]
<a href="https://example.com">リンク</a>
```

### ❌ 間違った書き方

```
ページ: おすすめ家庭用脱毛器比較

[Contentプロパティ]
記事の本文をここに書く ← これはHTMLが消えます
```

## トラブルシューティング

### 問題: 記事内容が表示されない

**解決方法:**
1. 記事のStatusが「Published」になっているか確認
2. ページの本文に記事内容があるか確認
3. 管理ページで再同期を実行
4. ブラウザのコンソール（F12）でエラーを確認

### 問題: コードブロックが表示されない

**解決方法:**
1. コードブロックの言語を「html」または「xml」に設定
2. HTMLコードはそのまま書く（エスケープ不要）

### 問題: リンクが表示されない

**解決方法:**
1. Notionでリンクを正しく設定（URLを入力）
2. リンクは自動的に `<a>` タグに変換されます

## データベースを再作成する場合

もしデータベースを再作成する必要がある場合は、以下のコマンドでデータベースを作成できます：

```bash
python3 scripts/sync_affiling_articles.py ensure-db
```

ただし、既存の記事データは削除される可能性があるため、注意してください。

